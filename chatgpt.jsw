import { fetch } from 'wix-fetch';
import { secrets } from 'wix-secrets-backend';

export async function sendMessageToChatGPT(conversationHistory) {
    const apiKey = await secrets.get('openai_api_key');
    const apiUrl = 'https://api.openai.com/v1/chat/completions';

    try {
        const response = await fetch(apiUrl, {
            method: 'post',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${apiKey}`
            },
            body: JSON.stringify({
                model: 'gpt-3.5-turbo',
                messages: conversationHistory, // Sending the full conversation history
                max_tokens: 100,
                temperature: 0.7
            })
        });

        if (response.ok) {
            const data = await response.json();
            return data.choices[0].message.content; // Returning the response from ChatGPT
        } else {
            throw new Error('Failed to fetch ChatGPT response');
        }
    } catch (error) {
        console.error("Error calling ChatGPT API:", error);
        throw new Error("Unable to process your request at the moment.");
    }
}